<!-- reply.html -->
<div class="each-reply">
    <div class="reply-header">
        <img src="{{ reply.author.profile.profile_image.url }}">
        <div class="reply-header-author">
            <p>{{ reply.author }}</p>
            <div class="text-muted small">{{ reply.timestamp|date:"j F, Y" }}</div>
        </div>
    </div>
    <div style="color: black; margin-left: 3rem;">{{ reply.body }}</div>
</div>
<form class="ml-3 like-comment-form" data-comment-id="{{ reply.id }}" style="margin-right: 1rem; margin-left: auto;">
    {% csrf_token %}
    <button type="button" class="btn btn-link transparent-button like-comment-button">
        <span class="like-icon">
            {% if request.user in reply.comment_likes.all %}
                <i class="fa fa-heart" style="font-size:18px;color:rgb(253, 58, 58);"></i>
            {% else %}
                <i class="fa fa-heart" style="font-size:18px;color:rgb(200, 200, 200);"></i>
            {% endif %}
        </span>
        <span class="like-count">{{ reply.comment_likes_count }}</span>
    </button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const likeButtons = document.querySelectorAll('.like-comment-button');
        likeButtons.forEach(button => {
            button.addEventListener('click', () => {
                const form = button.closest('.like-comment-form');
                const commentId = form.dataset.commentId;
                const url = '{% url "forum:like_comment" 0 %}'.replace('0', commentId);

                const xhr = new XMLHttpRequest();
                xhr.open('POST', url);
                xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        const likeCount = form.querySelector('.like-count');
                        const likeIcon = form.querySelector('.like-icon');

                        likeCount.textContent = response.likes_count;

                        if (response.is_liked) {
                            likeIcon.innerHTML = '<i class="fa fa-heart" style="font-size:18px;color:rgb(253, 58, 58);"></i>';
                        } else {
                            likeIcon.innerHTML = '<i class="fa fa-heart" style="font-size:18px;color:rgb(200, 200, 200);"></i>';
                        }
                    }
                };
                xhr.send(JSON.stringify({ comment_id: commentId }));
            });
        });
    });
</script>

